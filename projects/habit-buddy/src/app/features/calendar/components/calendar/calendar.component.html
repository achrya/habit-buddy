<div class="view max-w-5xl mx-auto">
  <!-- Calendar Header -->
  <div class="bg-white border border-slate-100 rounded-2xl p-3 mb-4 flex items-center justify-between">
    <div>
      <div class="text-sm font-semibold">{{ calendarTitle() }}</div>
      <div class="text-xs text-slate-400">
        Toggle per-habit mode to edit/check today only.
        @if (habits().length === 0) {
          <span class="text-orange-500 ml-2 flex items-center gap-1">
            <lucide-icon [img]="AlertTriangleIcon" size="14"></lucide-icon>
            No habits found. Create habits in Goals page first.
          </span>
        } @else {
          <span class="text-green-600 ml-2 flex items-center gap-1">
            <lucide-icon [img]="CheckCircleIcon" size="14"></lucide-icon>
            {{ habits().length }} habits loaded
          </span>
        }
      </div>
    </div>
    <div class="flex gap-2">
      <button (click)="previousMonth()" class="px-2 py-1 rounded bg-slate-50 flex items-center justify-center">
        <lucide-icon [img]="ChevronLeftIcon" size="16"></lucide-icon>
      </button>
      <button (click)="nextMonth()" class="px-2 py-1 rounded bg-slate-50 flex items-center justify-center">
        <lucide-icon [img]="ChevronRightIcon" size="16"></lucide-icon>
      </button>
    </div>
  </div>

  <!-- Habit Filters -->
  <div class="mb-3 flex gap-2 overflow-x-auto no-scrollbar pb-2">
    <button 
      (click)="setCalendarMode('all')"
      [class]="'px-3 py-1 rounded-full text-xs ' + (calendarMode() === 'all' ? 'bg-slate-900 text-white' : 'bg-white text-slate-700')">
      All Habits
    </button>
    @for (habit of habits(); track habit.id) {
      <button 
        (click)="setCalendarMode(habit.id)"
        [class]="'px-2 py-1 rounded-full text-xs border'"
        [style.background]="calendarMode() === habit.id ? habit.color : '#fff'"
        [style.color]="calendarMode() === habit.id ? 'white' : '#111'"
        [title]="habit.title">
        {{ getShortTitle(habit.title) }}
      </button>
    }
    @if (habits().length === 0) {
      <div class="px-3 py-1 text-xs text-slate-500 italic">
        No habits available. Go to Goals page to create habits.
      </div>
    }
  </div>

  <!-- Calendar Grid -->
  <div class="bg-white border border-slate-100 rounded-2xl p-3">
    <div class="grid grid-cols-7 gap-1 text-xs text-slate-500 mb-2">
      <div class="text-center">S</div>
      <div class="text-center">M</div>
      <div class="text-center">T</div>
      <div class="text-center">W</div>
      <div class="text-center">T</div>
      <div class="text-center">F</div>
      <div class="text-center">S</div>
    </div>
    
    <div class="grid grid-cols-7 gap-1">
      @for (day of calendarDays(); track day.date) {
        @if (calendarMode() === 'all') {
          <div class="bg-white border border-slate-100 p-2 rounded-lg text-xs h-16 flex flex-col justify-between">
            <div class="flex justify-between items-start">
              <div class="text-xs font-semibold">{{ day.day }}</div>
            </div>
            <div class="flex">
              @for (dot of getDayDots(day.date); track dot) {
                <span 
                  [style.background]="dot.color"
                  class="inline-block w-2 h-2 rounded-full mr-0.5"></span>
              }
            </div>
          </div>
        } @else {
          <button 
            [class]="'dateCell ' + (isDayChecked(day.date) ? 'bg-emerald-600 text-white' : 'bg-white') + ' border border-slate-100 p-2 rounded-lg text-xs h-16 flex flex-col justify-between w-full text-left'"
            [disabled]="!getSelectedHabit()"
            (click)="onDayClick(day.date)">
            <div class="text-xs font-semibold">{{ day.day }}</div>
            <div class="text-xs text-slate-400">{{ isDayChecked(day.date) ? 'Checked' : '' }}</div>
          </button>
        }
      }
    </div>
  </div>
</div>
