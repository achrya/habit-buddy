<div class="calendar-view max-w-5xl mx-auto px-2 sm:px-4">
  <!-- Calendar Header -->
  <div class="calendar-header bg-white border border-slate-100 rounded-xl sm:rounded-2xl p-3 sm:p-4 mb-3 sm:mb-4 shadow-sm">
    <!-- Mobile Layout -->
    <div class="block sm:hidden">
      <div class="flex items-center justify-between mb-3">
        <div class="text-base font-bold text-slate-800 truncate pr-2">{{ calendarTitle() }}</div>
        <div class="flex gap-1 flex-shrink-0">
          <button 
            (click)="previousMonth()" 
            class="nav-button tooltip-element px-2 py-1.5 rounded-lg bg-slate-50 hover:bg-slate-100 flex items-center justify-center transition-all duration-200"
            data-tooltip="Previous month"
            aria-label="Previous month">
            <lucide-icon [img]="ChevronLeftIcon" size="16"></lucide-icon>
          </button>
          <button 
            (click)="goToToday()" 
            class="nav-button tooltip-element px-2 py-1.5 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 flex items-center justify-center transition-all duration-200"
            data-tooltip="Go to current month"
            aria-label="Go to current month">
            <lucide-icon [img]="TodayIcon" size="16"></lucide-icon>
          </button>
          <button 
            (click)="nextMonth()" 
            class="nav-button tooltip-element px-2 py-1.5 rounded-lg bg-slate-50 hover:bg-slate-100 flex items-center justify-center transition-all duration-200"
            data-tooltip="Next month"
            aria-label="Next month">
            <lucide-icon [img]="ChevronRightIcon" size="16"></lucide-icon>
          </button>
        </div>
      </div>
      <div class="text-xs text-slate-600 mb-2">
        @if (calendarMode() === 'all') {
          <span class="flex items-center gap-1">
            <lucide-icon [img]="CalendarIcon" size="14" class="text-blue-500"></lucide-icon>
            <span>View all habits • Tap habits to toggle check-ins</span>
          </span>
        } @else {
          <span class="flex items-center gap-1">
            <lucide-icon [img]="TargetIcon" size="14" class="text-green-500"></lucide-icon>
            <span>Single habit mode • Tap today to toggle</span>
          </span>
        }
      </div>
    </div>

    <!-- Desktop Layout -->
    <div class="hidden sm:flex items-center justify-between">
      <div class="flex-1">
        <div class="text-lg font-bold text-slate-800 mb-1">{{ calendarTitle() }}</div>
        <div class="text-sm text-slate-600">
          @if (calendarMode() === 'all') {
            <span class="flex items-center gap-2">
              <lucide-icon [img]="CalendarIcon" size="16" class="text-blue-500"></lucide-icon>
              View all habits • Click individual habits to toggle daily check-ins
            </span>
          } @else {
            <span class="flex items-center gap-2">
              <lucide-icon [img]="TargetIcon" size="16" class="text-green-500"></lucide-icon>
              Single habit mode • Click today's date to toggle check-in
            </span>
          }
        </div>
      </div>
      <div class="flex gap-2 ml-4">
        <button 
          (click)="previousMonth()" 
          class="nav-button tooltip-element px-3 py-2 rounded-lg bg-slate-50 hover:bg-slate-100 flex items-center justify-center transition-all duration-200"
          data-tooltip="Previous month"
          aria-label="Previous month">
          <lucide-icon [img]="ChevronLeftIcon" size="18"></lucide-icon>
        </button>
        <button 
          (click)="goToToday()" 
          class="nav-button tooltip-element px-3 py-2 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 flex items-center justify-center transition-all duration-200"
          data-tooltip="Go to current month"
          aria-label="Go to current month">
          <lucide-icon [img]="TodayIcon" size="18"></lucide-icon>
        </button>
        <button 
          (click)="nextMonth()" 
          class="nav-button tooltip-element px-3 py-2 rounded-lg bg-slate-50 hover:bg-slate-100 flex items-center justify-center transition-all duration-200"
          data-tooltip="Next month"
          aria-label="Next month">
          <lucide-icon [img]="ChevronRightIcon" size="18"></lucide-icon>
        </button>
      </div>
    </div>

    <!-- Status Section (Mobile & Desktop) -->
    @if (habits().length === 0) {
      <div class="mt-2 sm:mt-2 p-2 sm:p-3 bg-orange-50 border border-orange-200 rounded-lg">
        <div class="flex items-center gap-2 text-orange-700">
          <lucide-icon [img]="AlertTriangleIcon" size="14" class="sm:w-4 sm:h-4"></lucide-icon>
          <span class="font-medium text-sm">No habits found</span>
        </div>
        <p class="text-xs sm:text-sm text-orange-600 mt-1">Create your first habit in the Goals page to see your progress here.</p>
      </div>
    } @else {
      <div class="mt-2 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 text-xs sm:text-sm">
        <div class="flex items-center gap-2 text-green-600">
          <lucide-icon [img]="CheckCircleIcon" size="14" class="sm:w-4 sm:h-4"></lucide-icon>
          <span class="font-medium">{{ habits().length }} habits</span>
        </div>
        @if (calendarMode() === 'all') {
          <div class="flex items-center gap-2 text-blue-600">
            <lucide-icon [img]="TrendingUpIcon" size="14" class="sm:w-4 sm:h-4"></lucide-icon>
            <span>{{ getMonthlyCompletionRate() }}% completion rate</span>
          </div>
        }
      </div>
    }
  </div>

  <!-- Habit Filters -->
  <div class="habit-filters mb-3 sm:mb-4">
    <!-- Mobile Layout -->
    <div class="block sm:hidden">
      <h3 class="text-xs font-semibold text-slate-700 mb-3 px-1 tooltip-element" data-tooltip="Switch between viewing all habits or individual habit progress">View Mode:</h3>
      <div class="flex gap-1 overflow-x-auto no-scrollbar pb-2 px-1">
        <button 
          (click)="setCalendarMode('all')"
          [class]="'mode-button tooltip-element px-3 py-1.5 rounded-lg text-xs font-medium transition-all duration-200 flex-shrink-0 ' + (calendarMode() === 'all' ? 'bg-slate-900 text-white shadow-md' : 'bg-white text-slate-700')"
          data-tooltip="View all habits"
          aria-pressed="calendarMode() === 'all'"
          aria-label="View all habits">
          <lucide-icon [img]="CalendarIcon" size="12" class="mr-1"></lucide-icon>
          All
        </button>
        @for (habit of habits(); track habit.id) {
          <button 
            (click)="setCalendarMode(habit.id)"
            [class]="'mode-button tooltip-element px-2 py-1.5 rounded-lg text-xs font-medium transition-all duration-200 flex-shrink-0'"
            [style.background]="calendarMode() === habit.id ? (habit.color || '#6366f1') : '#fff'"
            [style.color]="calendarMode() === habit.id ? 'white' : '#111'"
            [attr.data-tooltip]="getTooltipText(habit, true)"
            [aria-pressed]="calendarMode() === habit.id"
            [aria-label]="'View ' + habit.title + ' progress'">
            <div class="flex items-center gap-1">
              <div 
                class="w-1.5 h-1.5 rounded-full"
                [style.background]="habit.color || '#6366f1'"></div>
              <span class="truncate max-w-[60px]">{{ getShortTitle(habit.title) }}</span>
            </div>
          </button>
        }
      </div>
    </div>

    <!-- Desktop Layout -->
    <div class="hidden sm:block">
      <div class="flex items-center gap-3 mb-3 px-2">
        <h3 class="text-sm font-semibold text-slate-700 tooltip-element" data-tooltip="Switch between viewing all habits or individual habit progress">View Mode:</h3>
        <div class="flex gap-2 overflow-x-auto no-scrollbar">
          <button 
            (click)="setCalendarMode('all')"
            [class]="'mode-button tooltip-element px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ' + (calendarMode() === 'all' ? 'bg-slate-900 text-white shadow-md' : 'bg-white text-slate-700')"
            data-tooltip="View all habits"
            aria-pressed="calendarMode() === 'all'"
            aria-label="View all habits">
            <lucide-icon [img]="CalendarIcon" size="16" class="mr-2"></lucide-icon>
            All Habits
          </button>
          @for (habit of habits(); track habit.id) {
            <button 
              (click)="setCalendarMode(habit.id)"
              [class]="'mode-button tooltip-element px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200'"
              [style.background]="calendarMode() === habit.id ? (habit.color || '#6366f1') : '#fff'"
              [style.color]="calendarMode() === habit.id ? 'white' : '#111'"
              [attr.data-tooltip]="getTooltipText(habit, false)"
              [aria-pressed]="calendarMode() === habit.id"
              [aria-label]="'View ' + habit.title + ' progress'">
              <div class="flex items-center gap-2">
                <div 
                  class="w-2 h-2 rounded-full"
                  [style.background]="habit.color || '#6366f1'"></div>
                {{ getShortTitle(habit.title) }}
              </div>
            </button>
          }
        </div>
      </div>
    </div>

    @if (habits().length === 0) {
      <div class="p-3 sm:p-4 bg-slate-50 border border-slate-200 rounded-lg">
        <div class="flex items-center gap-2 text-slate-600">
          <lucide-icon [img]="PlusIcon" size="14" class="sm:w-4 sm:h-4"></lucide-icon>
          <span class="text-xs sm:text-sm">No habits available. Go to Goals page to create your first habit.</span>
        </div>
      </div>
    }
  </div>

  <!-- Calendar Grid -->
  <div class="calendar-grid bg-white border border-slate-100 rounded-xl sm:rounded-2xl p-2 sm:p-4 shadow-sm">
    <!-- Weekday Headers -->
    <div class="grid grid-cols-7 gap-0.5 sm:gap-1 text-xs sm:text-sm font-semibold text-slate-600 mb-2 sm:mb-3">
      <div class="text-center py-1 sm:py-2">S</div>
      <div class="text-center py-1 sm:py-2">M</div>
      <div class="text-center py-1 sm:py-2">T</div>
      <div class="text-center py-1 sm:py-2">W</div>
      <div class="text-center py-1 sm:py-2">T</div>
      <div class="text-center py-1 sm:py-2">F</div>
      <div class="text-center py-1 sm:py-2">S</div>
    </div>
    
    <!-- Calendar Days -->
    <div class="grid grid-cols-7 gap-0.5 sm:gap-1">
      @for (day of calendarDays(); track day.date) {
        @if (day.isEmpty) {
          <div class="calendar-day empty h-12 sm:h-16 md:h-20 lg:h-24"></div>
        } @else if (calendarMode() === 'all') {
          <div 
            class="calendar-day all-mode h-12 sm:h-16 md:h-20 lg:h-24"
            [class]="'calendar-day all-mode h-12 sm:h-16 md:h-20 lg:h-24 ' + getDayStatusClass(day.date)">
            <div class="day-content">
              <div class="day-number">{{ day.day }}</div>
              <div class="habit-dots">
                @for (dot of getDayDots(day.date); track dot) {
                  <div 
                    class="habit-dot"
                    [style.background]="dot.color || '#e5e7eb'"></div>
                }
              </div>
              @if (getDayDots(day.date).length > 3) {
                <div class="more-dots">+{{ getDayDots(day.date).length - 3 }}</div>
              }
            </div>
          </div>
        } @else {
          <button 
            class="calendar-day single-mode h-12 sm:h-16 md:h-20 lg:h-24"
            [class]="'calendar-day single-mode h-12 sm:h-16 md:h-20 lg:h-24 ' + getDayStatusClass(day.date)"
            [disabled]="!getSelectedHabit() || !canToggleDay(day.date)"
            (click)="onDayClick(day.date)"
            [title]="getDayTooltip(day.date)"
            [aria-label]="getDayAriaLabel(day.date)">
            <div class="day-content">
              <div class="day-number">{{ day.day }}</div>
              <div class="day-status">
                @if (isDayChecked(day.date)) {
                  <lucide-icon [img]="CheckIcon" size="12" class="sm:w-4 sm:h-4 text-white"></lucide-icon>
                } @else if (canToggleDay(day.date)) {
                  <lucide-icon [img]="PlusIcon" size="10" class="sm:w-3 sm:h-3 text-slate-400"></lucide-icon>
                }
              </div>
            </div>
          </button>
        }
      }
    </div>
  </div>

</div>
