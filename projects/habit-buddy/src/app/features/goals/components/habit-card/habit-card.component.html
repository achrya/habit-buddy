<article class="habit-card">
  <!-- Header with title and status -->
  <div class="card-header">
    <h3 class="habit-title">{{ habit().title }}</h3>
    <div class="habit-status" [class]="isCheckedToday() ? 'status-completed' : 'status-active'">
      {{ statusText() }}
    </div>
  </div>

  <!-- Main content area -->
  <div class="card-content">
    <!-- Left side: Circular progress chart -->
    <div class="chart-section" [attr.data-tooltip]="chartTooltip()">
      <app-circular-progress 
        [percentage]="progressPercentage()"
        [size]="120"
        [strokeWidth]="8"
        [label]="badgeLevelText()"
        [primaryColor]="'#6366f1'"
        [secondaryColor]="'#e5e7eb'"
        [tertiaryColor]="'#f59e0b'"
        [activityData]="getRecentActivityDays()">
        <div slot="icon" class="chart-icon">
          <lucide-icon [img]="getBadgeIcon()" size="20" class="text-yellow-500"></lucide-icon>
        </div>
      </app-circular-progress>
    </div>

    <!-- Right side: Stats and actions -->
    <div class="stats-section">
      <!-- Motivational message - moved to top -->
      <div class="motivation-section" [class]="isCheckedToday() ? 'motivation-completed' : 'motivation-active'">
        <div class="motivation-title">{{ statusText() }}</div>
        <div class="motivation-message">{{ motivationalMessage() }}</div>
      </div>


      <!-- Stats row - side by side -->
      <div class="stats-row">
        <!-- Total days stat - foundation info on left -->
        <div class="stat-item">
          <div class="stat-value">{{ completedCount() }}</div>
          <div class="stat-label">Total Days</div>
        </div>

        <!-- Current streak stat - prominent achievement on right -->
        <div class="stat-item">
          <div class="stat-value streak-value">{{ stats().current }}</div>
          <div class="stat-label">Day Streak</div>
        </div>
      </div>

      <!-- Streak Break Visualization -->
      <div class="streak-breaks-section">
        <h4 class="section-title">Last 14 Days</h4>
        <div class="activity-timeline">
          @for (day of getRecentActivityDays(); track day.date) {
            <div class="activity-day" 
                 [class]="day.status"
                 [title]="day.tooltip">
              <div class="day-indicator"></div>
            </div>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Action buttons -->
  <div class="action-buttons">
    <!-- Left side: Icon buttons group -->
    <div class="icon-buttons-group">
      <button 
        class="action-btn icon-btn"
        (click)="onViewCalendar()"
        title="View calendar">
        <lucide-icon [img]="LinkIcon" size="16"></lucide-icon>
      </button>
      <button 
        class="action-btn icon-btn"
        (click)="onRemove()"
        title="Remove habit">
        <lucide-icon [img]="Trash2Icon" size="16"></lucide-icon>
      </button>
      <button 
        class="action-btn icon-btn"
        (click)="onEditReminder()"
        title="Edit reminder">
        <lucide-icon [img]="BellIcon" size="16"></lucide-icon>
      </button>
      <button 
        class="action-btn icon-btn"
        (click)="onViewCalendar()"
        title="View calendar">
        <lucide-icon [img]="CalendarIcon" size="16"></lucide-icon>
      </button>
    </div>

    <!-- Right side: Check in button -->
    <button 
      class="check-in-btn"
      (click)="onCheckin()"
      [class]="isCheckedToday() ? 'checked-in' : 'not-checked-in'"
      [title]="isCheckedToday() ? 'Already checked in today!' : 'Check in for today'">
      @if (isCheckedToday()) {
        <lucide-icon [img]="CheckIcon" size="16" class="mr-1"></lucide-icon>
        <span>Done!</span>
      } @else {
        <span>Check In</span>
      }
    </button>
  </div>
</article>

<!-- Delete Confirmation Dialog -->
<app-dialog
  [isOpen]="showDeleteDialog()"
  title="Delete Habit"
  [message]="getDeleteMessage()"
  type="danger"
  [buttons]="deleteDialogButtons"
  (close)="onDeleteDialogClose()"
  (buttonClick)="onDeleteDialogAction($event)">
</app-dialog>